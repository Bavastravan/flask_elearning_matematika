{% extends "base.html" %}

{% block title %}Daftar Akun Siswa - E-Learning Matematika SD{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-900 px-4 py-10">
  <div class="relative w-full max-w-md">
    <!-- Aksen angka -->
    <div class="pointer-events-none absolute -top-6 -left-6 w-16 h-16 rounded-2xl border border-sky-300/60 dark:border-sky-500/40 flex items-center justify-center text-xs font-semibold text-sky-400 dark:text-sky-300 bg-sky-50/60 dark:bg-slate-900/60">
      2 + 3 = 5
    </div>
    <div class="pointer-events-none absolute -bottom-6 -right-8 w-16 h-16 rounded-full border border-emerald-300/60 dark:border-emerald-400/40 flex items-center justify-center text-xs font-semibold text-emerald-400 dark:text-emerald-300 bg-emerald-50/40 dark:bg-slate-900/60">
      6 Ã· 2 = 3
    </div>

    <!-- Kartu register -->
    <div class="relative bg-white/90 dark:bg-slate-900/90 border border-slate-200 dark:border-slate-700 rounded-2xl shadow-xl shadow-sky-100/60 dark:shadow-black/40 backdrop-blur px-6 py-7">
      <div class="mb-5 text-center space-y-1">
        <p class="text-xs uppercase tracking-[0.18em] text-sky-500 dark:text-sky-400">
          Daftar Akun
        </p>
        <h1 class="text-xl font-semibold text-slate-900 dark:text-slate-50">
          Bergabung ke Eâ€‘Learning Matematika SD
        </h1>
        <p class="text-xs text-slate-600 dark:text-slate-300">
          Buat akun untuk mengakses latihan penjumlahan, pengurangan, perkalian, dan pembagian.
        </p>
      </div>

      <form method="POST" class="space-y-4">
        {{ form.hidden_tag() if form is defined }}

        <!-- Nama lengkap (wajib) -->
        <div class="space-y-1">
          <label for="nama" class="block text-xs font-medium text-slate-700 dark:text-slate-200">
            Nama lengkap<span class="text-red-500">*</span>
          </label>
          <input
            id="nama"
            name="nama"
            type="text"
            required
            minlength="3"
            class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900/80
                   px-3 py-2.5 text-sm text-slate-900 dark:text-slate-100
                   focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500
                   placeholder:text-slate-400 dark:placeholder:text-slate-500"
            placeholder="Misal: Bintang Alfarizi"
          >
        </div>

               <!-- Nama sekolah (opsional) -->
        <div class="space-y-1">
          <label for="nama_sekolah" class="block text-xs font-medium text-slate-700 dark:text-slate-200">
            Nama sekolah <span class="text-slate-400 text-[10px]">(opsional)</span>
          </label>
          <input
            id="nama_sekolah"
            name="nama_sekolah"
            type="text"
            class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900/80
                   px-3 py-2.5 text-sm text-slate-900 dark:text-slate-100
                   focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500
                   placeholder:text-slate-400 dark:placeholder:text-slate-500"
            placeholder="SD Negeri 01 Contoh"
          >
        </div>

        <!-- Kelas (wajib) -->
        <div class="space-y-1">
          <label for="kelas" class="block text-xs font-medium text-slate-700 dark:text-slate-200">
            Kelas<span class="text-red-500">*</span>
          </label>
          <select
            id="kelas"
            name="kelas"
            required
            class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900/80
                   px-3 py-2.5 text-sm text-slate-900 dark:text-slate-100
                   focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            <option value="">Pilih kelas</option>
            {% for k in range(1,7) %}
            <option value="{{ k }}">Kelas {{ k }}</option>
            {% endfor %}
          </select>
        </div>


        <!-- Email (wajib) -->
        <div class="space-y-1">
          <label for="email" class="block text-xs font-medium text-slate-700 dark:text-slate-200">
            Email<span class="text-red-500">*</span>
          </label>
          <input
            id="email"
            name="email"
            type="email"
            required
            inputmode="email"
            autocomplete="email"
            class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900/80
                   px-3 py-2.5 text-sm text-slate-900 dark:text-slate-100
                   focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500
                   placeholder:text-slate-400 dark:placeholder:text-slate-500"
            placeholder="nama@sekolah.sch.id"
          >
        </div>

        <!-- Password -->
        <div class="space-y-1">
          <label for="password" class="block text-xs font-medium text-slate-700 dark:text-slate-200">
            Password<span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <input
              id="password"
              name="password"
              type="password"
              required
              minlength="8"
              autocomplete="new-password"
              class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900/80
                     px-3 py-2.5 pr-10 text-sm text-slate-900 dark:text-slate-100
                     focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500
                     placeholder:text-slate-400 dark:placeholder:text-slate-500"
              placeholder="Min. 8 karakter (huruf & angka)"
            >
            <button
              type="button"
              id="toggle-password"
              class="absolute inset-y-0 right-2 flex items-center text-slate-400 dark:text-slate-500 hover:text-sky-500 dark:hover:text-sky-400"
              aria-label="Tampilkan / sembunyikan password"
            >
              <span id="icon-password" class="text-lg">ğŸ‘ï¸</span>
            </button>
          </div>
        </div>

        <!-- Konfirmasi password -->
        <div class="space-y-1">
          <label for="password_confirm" class="block text-xs font-medium text-slate-700 dark:text-slate-200">
            Ulangi password<span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <input
              id="password_confirm"
              name="password_confirm"
              type="password"
              required
              minlength="8"
              class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900/80
                     px-3 py-2.5 pr-10 text-sm text-slate-900 dark:text-slate-100
                     focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500
                     placeholder:text-slate-400 dark:placeholder:text-slate-500"
              placeholder="Ketik ulang password"
            >
            <button
              type="button"
              id="toggle-password-confirm"
              class="absolute inset-y-0 right-2 flex items-center text-slate-400 dark:text-slate-500 hover:text-sky-500 dark:hover:text-sky-400"
              aria-label="Tampilkan / sembunyikan password konfirmasi"
            >
              <span id="icon-password-confirm" class="text-lg">ğŸ‘ï¸</span>
            </button>
          </div>
        </div>

        <!-- Peran (tetap siswa SD) -->
        <div class="space-y-1">
          <label for="role" class="block text-xs font-medium text-slate-700 dark:text-slate-200">
            Saya adalah<span class="text-red-500">*</span>
          </label>
          <select
            id="role"
            name="role"
            required
            class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900/80
                   px-3 py-2.5 text-sm text-slate-900 dark:text-slate-100
                   focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            <option value="siswa">Siswa SD</option>
          </select>
        </div>

        <!-- Persetujuan cookie & pendamping orang tua -->
        <div class="space-y-2 text-[11px] text-slate-600 dark:text-slate-300">
          <label class="flex items-start gap-2">
            <input
              type="checkbox"
              name="cookie_consent"
              id="cookie_consent"
              required
              class="mt-0.5 h-3.5 w-3.5 rounded border-slate-300 dark:border-slate-600 text-sky-500 focus:ring-sky-500"
            >
            <span>
              Saya menyetujui penggunaan cookie untuk meningkatkan pengalaman belajar di Eâ€‘Learning Matematika SD.
            </span>
          </label>

          <label class="flex items-start gap-2">
            <input
              type="checkbox"
              name="parent_consent"
              id="parent_consent"
              required
              class="mt-0.5 h-3.5 w-3.5 rounded border-slate-300 dark:border-slate-600 text-sky-500 focus:ring-sky-500"
            >
            <span>
              Sebelum melanjutkan, saya menyatakan bahwa <strong>pendaftaran ini saya didampingi oleh orang tua saya dan tanpa paksaan</strong>.
            </span>
          </label>
        </div>

        <!-- Tombol daftar -->
        <button
          type="button"
          id="btn-register"
          class="w-full inline-flex items-center justify-center rounded-full bg-sky-500 hover:bg-sky-600
                 text-white text-sm font-medium py-2.5 mt-2 shadow-md shadow-sky-500/40 transition"
        >
          Daftar Sekarang
        </button>
      </form>

      <!-- Link ke login -->
      <p class="mt-4 text-[11px] text-center text-slate-600 dark:text-slate-300">
        Sudah punya akun?
        <a href="{{ url_for('auth.login') }}" class="font-semibold text-sky-600 hover:text-sky-700 dark:text-sky-400 dark:hover:text-sky-300">
          Masuk di sini
        </a>
      </p>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // toggle password
  const pwd = document.getElementById("password");
  const pwdBtn = document.getElementById("toggle-password");
  const pwdIcon = document.getElementById("icon-password");

  const pwd2 = document.getElementById("password_confirm");
  const pwd2Btn = document.getElementById("toggle-password-confirm");
  const pwd2Icon = document.getElementById("icon-password-confirm");

  function setupToggle(input, btn, icon) {
    if (!input || !btn || !icon) return;
    btn.addEventListener("click", () => {
      const isHidden = input.type === "password";
      input.type = isHidden ? "text" : "password";
      icon.textContent = isHidden ? "ğŸ‘â€ğŸ—¨" : "ğŸ‘ï¸";
    });
  }

  setupToggle(pwd, pwdBtn, pwdIcon);
  setupToggle(pwd2, pwd2Btn, pwd2Icon);

  // konfirmasi sebelum submit + validasi ekstra
  const form = document.querySelector("form");
  const btnRegister = document.getElementById("btn-register");
  const cookie = document.getElementById("cookie_consent");
  const parentConsent = document.getElementById("parent_consent");
  const namaSekolah = document.getElementById("nama_sekolah");

  if (btnRegister && form) {
    btnRegister.addEventListener("click", () => {
      if (!cookie.checked || !parentConsent.checked) {
        alert("Harap centang persetujuan cookie dan pernyataan pendamping orang tua terlebih dahulu.");
        return;
      }

      const pwdVal = pwd.value || "";
      if (pwdVal.length < 8 || !/[0-9]/.test(pwdVal) || !/[A-Za-z]/.test(pwdVal)) {
        alert("Password minimal 8 karakter dan mengandung huruf serta angka.");
        return;
      }

      if (pwdVal !== (pwd2.value || "")) {
        alert("Password dan konfirmasi password harus sama.");
        return;
      }

      if (namaSekolah && namaSekolah.value && namaSekolah.value.trim().length < 3) {
        alert("Nama sekolah terlalu pendek, harap isi dengan benar atau kosongkan jika ragu.");
        return;
      }

      const ok = confirm(
        "Sebelum melanjutkan, pastikan:\n\n" +
        "â€¢ Pendaftaran ini didampingi orang tua/wali.\n" +
        "â€¢ Kamu mendaftar tanpa paksaan.\n\n" +
        "Lanjutkan pendaftaran?"
      );

      if (ok) {
        form.submit();
      }
    });
  }
});
</script>
{% endblock %}
